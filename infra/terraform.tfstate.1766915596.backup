{
  "version": 4,
  "terraform_version": "1.13.5",
  "serial": 154,
  "lineage": "ec3b0d0b-42f1-4153-d335-606fdbd55547",
  "outputs": {
    "bucket_name": {
      "value": "otus-bucket3-b1gukkncvsp3tvci7gp3",
      "type": "string"
    },
    "proxy_public_ip": {
      "value": "46.21.247.166",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "time_sleep",
      "name": "wait_for_s3_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/time\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "create_duration": "30s",
            "destroy_duration": null,
            "id": "2025-12-28T07:10:47Z",
            "triggers": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa",
            "yandex_iam_service_account_static_access_key.sa-static-key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "tls_private_key",
      "name": "cluster_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/tls\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "algorithm": "ED25519",
            "ecdsa_curve": "P224",
            "id": "794a2cbcc1dbb5cbd6d04a31563f33b1d6f308fc",
            "private_key_openssh": "-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtz\nc2gtZWQyNTUxOQAAACBrMBxl5bivj5UUM0EpFoxCFRS4H9qFRekhyT8Bw6IrOAAA\nAIh19ZaBdfWWgQAAAAtzc2gtZWQyNTUxOQAAACBrMBxl5bivj5UUM0EpFoxCFRS4\nH9qFRekhyT8Bw6IrOAAAAED5hlNUNun8r2uT16xEj9HWlH19+MSr/DKtH0nKxPQB\nfGswHGXluK+PlRQzQSkWjEIVFLgf2oVF6SHJPwHDois4AAAAAAECAwQF\n-----END OPENSSH PRIVATE KEY-----\n",
            "private_key_pem": "-----BEGIN PRIVATE KEY-----\nMC4CAQAwBQYDK2VwBCIEIPmGU1Q26fyva5PXrESP0daUfX34xKv8Mq0fScrE9AF8\n-----END PRIVATE KEY-----\n",
            "private_key_pem_pkcs8": "-----BEGIN PRIVATE KEY-----\nMC4CAQAwBQYDK2VwBCIEIPmGU1Q26fyva5PXrESP0daUfX34xKv8Mq0fScrE9AF8\n-----END PRIVATE KEY-----\n",
            "public_key_fingerprint_md5": "57:84:e8:3f:73:bf:46:f5:87:d7:fc:f1:75:48:c4:2e",
            "public_key_fingerprint_sha256": "SHA256:sE3wCbk7d9y5ZFYgRszMblufwcASkwu3JsnzZe/WLxc",
            "public_key_openssh": "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGswHGXluK+PlRQzQSkWjEIVFLgf2oVF6SHJPwHDois4\n",
            "public_key_pem": "-----BEGIN PUBLIC KEY-----\nMCowBQYDK2VwAyEAazAcZeW4r4+VFDNBKRaMQhUUuB/ahUXpIck/AcOiKzg=\n-----END PUBLIC KEY-----\n",
            "rsa_bits": 2048
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "private_key_openssh"
              }
            ],
            [
              {
                "type": "get_attr",
                "value": "private_key_pem"
              }
            ],
            [
              {
                "type": "get_attr",
                "value": "private_key_pem_pkcs8"
              }
            ]
          ],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_disk",
      "name": "boot_disk",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allow_recreate": null,
            "block_size": 4096,
            "created_at": "2025-12-28T07:10:13Z",
            "description": "",
            "disk_placement_policy": [
              {
                "disk_placement_group_id": ""
              }
            ],
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "id": "fhmkp9jm3tldu90b7c4s",
            "image_id": "fd808e721rc1vt7jkd0o",
            "kms_key_id": null,
            "labels": null,
            "name": "boot-disk",
            "product_ids": [
              "f2e8r6k9f9dsnn65dcf8"
            ],
            "size": 30,
            "snapshot_id": "",
            "status": "ready",
            "timeouts": null,
            "type": "network-hdd",
            "zone": "ru-central1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_compute_instance",
      "name": "proxy",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "allow_recreate": null,
            "allow_stopping_for_update": true,
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "fhmkp9jm3tldu90b7c4s",
                "disk_id": "fhmkp9jm3tldu90b7c4s",
                "initialize_params": [
                  {
                    "block_size": 4096,
                    "description": "",
                    "image_id": "fd808e721rc1vt7jkd0o",
                    "kms_key_id": "",
                    "name": "boot-disk",
                    "size": 30,
                    "snapshot_id": "",
                    "type": "network-hdd"
                  }
                ],
                "mode": "READ_WRITE"
              }
            ],
            "created_at": "2025-12-28T07:14:12Z",
            "description": "",
            "filesystem": [],
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "fqdn": "fhmc1hj8ardmsdb0mc3q.auto.internal",
            "gpu_cluster_id": "",
            "hardware_generation": [
              {
                "generation2_features": [],
                "legacy_features": [
                  {
                    "pci_topology": "PCI_TOPOLOGY_V1"
                  }
                ]
              }
            ],
            "hostname": "",
            "id": "fhmc1hj8ardmsdb0mc3q",
            "labels": null,
            "local_disk": [],
            "maintenance_grace_period": "",
            "maintenance_policy": null,
            "metadata": {
              "user-data": "\r\n#cloud-config\r\ndatasource:\r\n  Ec2:\r\n    strict_id: false\r\nssh_pwauth: no\r\nusers:\r\n  - name: ubuntu\r\n    sudo: 'ALL=(ALL) NOPASSWD:ALL'\r\n    shell: /bin/bash\r\n    ssh_authorized_keys:\r\n      ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOAa0DqJFuUps2c+v3zJm/gHR9O1XTJuO98788RklYVF rk@DESKTOP-4HH2JVC\r\n\r\nwrite_files:\r\n  - path: \"/home/ubuntu/.ssh/dataproc_key\"\r\n    permissions: \"755\"\r\n    owner: ubuntu:ubuntu\r\n    content: LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFNd0FBQUF0egpjMmd0WldReU5UVXhPUUFBQUNCck1CeGw1Yml2ajVVVU0wRXBGb3hDRlJTNEg5cUZSZWtoeVQ4Qnc2SXJPQUFBCkFJaDE5WmFCZGZXV2dRQUFBQXR6YzJndFpXUXlOVFV4T1FBQUFDQnJNQnhsNWJpdmo1VVVNMEVwRm94Q0ZSUzQKSDlxRlJla2h5VDhCdzZJck9BQUFBRUQ1aGxOVU51bjhyMnVUMTZ4RWo5SFdsSDE5K01Tci9ES3RIMG5LeFBRQgpmR3N3SEdYbHVLK1BsUlF6UVNrV2pFSVZGTGdmMm9WRjZTSEpQd0hEb2lzNEFBQUFBQUVDQXdRRgotLS0tLUVORCBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0K\r\n    encoding: b64\r\n    defer: true\r\n  - path: \"/home/ubuntu/scripts/upload_data_to_hdfs.sh\"\r\n    permissions: \"755\"\r\n    owner: ubuntu:ubuntu\r\n    content: |\r\n      #!/bin/bash\n      \n      # Функция логирования\n      function log() {\n          sep=\"----------------------------------------------------------\"\n          echo \"[$(date)] $sep \"\n          echo \"[$(date)] [INFO] $1\"\n      }\n      \n      # Проверяем, передан ли аргумент (имя файла)\n      if [ -n \"$1\" ]; then\n          FILE_NAME=\"$1\"\n          log \"File name provided: $FILE_NAME\"\n      else\n          log \"No file name provided, copying all files\"\n      fi\n      \n      # Создаем директорию в HDFS\n      log \"Creating directory in HDFS\"\n      hdfs dfs -mkdir -p /user/ubuntu/data\n      \n      # Копируем данные из S3 в зависимости от того, передано ли имя файла\n      if [ -n \"$FILE_NAME\" ]; then\n          # Копируем конкретный файл\n          log \"Copying specific file from S3 to HDFS\"\n          hadoop distcp s3a://{{ s3_bucket }}/$FILE_NAME /user/ubuntu/data/$FILE_NAME\n      else\n          # Копируем все данные\n          log \"Copying all data from S3 to HDFS\"\n          hadoop distcp s3a://{{ s3_bucket }}/ /user/ubuntu/data\n      fi\n      \n      # Выводим содержимое директории для проверки\n      log \"Listing files in HDFS directory\"\n      hdfs dfs -ls /user/ubuntu/data\n      \n      # Проверяем успешность выполнения операции\n      if [ $? -eq 0 ]; then\n          log \"Data was successfully copied to HDFS\"\n      else\n          log \"Failed to copy data to HDFS\"\n          exit 1\n      fi\n      \r\n    defer: true\r\n  - path: \"/home/ubuntu/scripts/user_data.sh\"\r\n    permissions: \"755\"\r\n    owner: ubuntu:ubuntu\r\n    content: |\r\n      #!/bin/bash\n      \n      token=\"$1\"\n      cloud_id=\"$2\"\n      folder_id=\"$3\"\n      access_key=\"$4\"\n      secret_key=\"$5\"\n      s3_bucket=\"$6\"\n      \n      # Функция для логирования\n      function log() {\n          sep=\"----------------------------------------------------------\"\n          echo \"[$(date +'%Y-%m-%d %H:%M:%S')] $sep \" | tee -a $HOME/user_data_execution.log\n          echo \"[$(date +'%Y-%m-%d %H:%M:%S')] [INFO] $1\" | tee -a $HOME/user_data_execution.log\n      }\n      \n      log \"Starting user data script execution\"\n      \n      # Устанавливаем yc CLI\n      log \"Installing yc CLI\"\n      export HOME=\"/home/ubuntu\"\n      curl https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash\n      \n      # Изменяем владельца директории yandex-cloud и её содержимого\n      log \"Changing ownership of yandex-cloud directory\"\n      sudo chown -R ubuntu:ubuntu $HOME/yandex-cloud\n      \n      # Применяем изменения из .bashrc\n      log \"Applying changes from .bashrc\"\n      source $HOME/.bashrc\n      \n      # Проверяем, что yc доступен\n      if command -v yc \u0026\u003e /dev/null; then\n          log \"yc CLI is now available\"\n          yc --version\n      else\n          log \"yc CLI is still not available. Adding it to PATH manually\"\n          export PATH=\"$PATH:$HOME/yandex-cloud/bin\"\n          yc --version\n      fi\n      \n      # Настраиваем yc CLI\n      log \"Configuring yc CLI\"\n      yc config set token $token\n      yc config set cloud-id $cloud_id\n      yc config set folder-id $folder_id\n      \n      # Устанавливаем jq\n      log \"Installing jq\"\n      sudo apt-get update\n      sudo apt-get install -y jq\n      \n      # Получаем ID мастер-ноды Dataproc кластера\n      log \"Getting Dataproc master node ID\"\n      DATAPROC_MASTER_FQDN=$(yc compute instance list --format json | jq -r '.[] | select(.labels.subcluster_role == \"masternode\") | .fqdn')\n      \n      if [ -z \"$DATAPROC_MASTER_FQDN\" ]; then\n          log \"Failed to get master node ID\"\n          exit 1\n      fi\n      \n      log \"Master node FQDN: $DATAPROC_MASTER_FQDN\"\n      \n      # Создаем директорию .ssh и настраиваем приватный ключ\n      #log \"Creating .ssh directory and setting up private key\"\n      #mkdir -p /home/ubuntu/.ssh\n      #mv /home/ubuntu/dataproc_key \u003e /home/ubuntu/.ssh/dataproc_key\n      #chmod 600 /home/ubuntu/.ssh/dataproc_key\n      #chown ubuntu:ubuntu /home/ubuntu/.ssh/dataproc_key\n      \n      # Добавляем конфигурацию SSH для удобного подключения к мастер-ноде\n      log \"Adding SSH configuration for master node connection\"\n      cat \u003c\u003cEOF \u003e /home/ubuntu/.ssh/config\n      Host dataproc-master\n          HostName $DATAPROC_MASTER_FQDN\n          User ubuntu\n          IdentityFile ~/.ssh/dataproc_key\n          StrictHostKeyChecking no\n          UserKnownHostsFile /dev/null\n      EOF\n      \n      chown ubuntu:ubuntu /home/ubuntu/.ssh/config\n      chmod 600 /home/ubuntu/.ssh/config\n      \n      # Настраиваем SSH-agent\n      log \"Configuring SSH-agent\"\n      eval $(ssh-agent -s)\n      echo \"eval \\$(ssh-agent -s)\" \u003e\u003e /home/ubuntu/.bashrc\n      ssh-add /home/ubuntu/.ssh/dataproc_key\n      echo \"ssh-add /home/ubuntu/.ssh/dataproc_key\" \u003e\u003e /home/ubuntu/.bashrc\n      \n      # Устанавливаем дополнительные полезные инструменты\n      log \"Installing additional tools\"\n      apt-get update\n      apt-get install -y tmux htop iotop\n      \n      # Устанавливаем s3cmd\n      log \"Installing s3cmd\"\n      apt-get install -y s3cmd\n      \n      # Настраиваем s3cmd\n      log \"Configuring s3cmd\"\n      cat \u003c\u003cEOF \u003e /home/ubuntu/.s3cfg\n      [default]\n      access_key = $access_key\n      secret_key = $secret_key\n      host_base = storage.yandexcloud.net\n      host_bucket = %(bucket)s.storage.yandexcloud.net\n      use_https = True\n      EOF\n      \n      chown ubuntu:ubuntu /home/ubuntu/.s3cfg\n      chmod 600 /home/ubuntu/.s3cfg\n      \n      # Определяем целевой бакет\n      TARGET_BUCKET=$s3_bucket\n      \n      # Копируем скрипт upload_data_to_hdfs.sh на прокси-машину\n      #log \"upload_data_to_hdfs.sh script processing \"\n      #echo '$upoad_data_to_hdfs_path' \u003e /home/ubuntu/scripts/upload_data_to_hdfs.sh\n      sed -i 's/{{ s3_bucket }}/'$TARGET_BUCKET'/g' /home/ubuntu/scripts/upload_data_to_hdfs.sh\n      \n      # Устанавливаем правильные разрешения для скрипта на прокси-машине\n      #log \"Setting permissions for upload_data_to_hdfs.sh on proxy machine\"\n      chmod +x /home/ubuntu/scripts/upload_data_to_hdfs.sh\n      \n      # Проверяем подключение к мастер-ноде\n      log \"Checking connection to master node\"\n      source /home/ubuntu/.bashrc\n      ssh -i /home/ubuntu/.ssh/dataproc_key -o StrictHostKeyChecking=no ubuntu@$DATAPROC_MASTER_FQDN \"echo 'Connection successful'\"\n      if [ $? -eq 0 ]; then\n          log \"Connection to master node successful\"\n      else\n          log \"Failed to connect to master node\"\n          exit 1\n      fi\n      \n      # Копируем скрипт upload_data_to_hdfs.sh с прокси-машины на мастер-ноду\n      log \"Copying upload_data_to_hdfs.sh script from proxy machine to master node\"\n      scp -i /home/ubuntu/.ssh/dataproc_key -o StrictHostKeyChecking=no /home/ubuntu/scripts/upload_data_to_hdfs.sh ubuntu@$DATAPROC_MASTER_FQDN:/home/ubuntu/\n      \n      # Устанавливаем правильные разрешения для скрипта на мастер-ноде\n      log \"Setting permissions for upload_data_to_hdfs.sh on master node\"\n      ssh -i /home/ubuntu/.ssh/dataproc_key -o StrictHostKeyChecking=no ubuntu@$DATAPROC_MASTER_FQDN \"chmod +x /home/ubuntu/upload_data_to_hdfs.sh\"\n      \n      log \"Script upload_data_to_hdfs.sh has been copied to the master node\"\n      \n      # Изменяем владельца лог-файла\n      log \"Changing ownership of log file\"\n      sudo chown ubuntu:ubuntu /home/ubuntu/user_data_execution.log\n      \n      log \"User data script execution completed\"\r\n    defer: true\r\nruncmd:\r\n  - [ \"/home/ubuntu/scripts/user_data.sh\", \"y0__xC9t6ElGMHdEyCGqKycFTCF0LCcCD7w1M_fWSMyPDkcBoPXJ5tAJYN5\", \"b1gnk3njjck96opvt45t\", \"b1gukkncvsp3tvci7gp3\", \"YCAJE_8F8bdUdVmW_iAtM1pmx\", \"YCOSU74kQN2JM8-RAVJSgi6FsC1UWonOR9aKtnak\", \"otus-bucket3-b1gukkncvsp3tvci7gp3\" ]\r\n"
            },
            "metadata_options": [
              {
                "aws_v1_http_endpoint": 1,
                "aws_v1_http_token": 2,
                "gce_http_endpoint": 1,
                "gce_http_token": 1
              }
            ],
            "name": "otus-proxy-vm",
            "network_acceleration_type": "standard",
            "network_interface": [
              {
                "dns_record": [],
                "index": 0,
                "ip_address": "10.0.0.100",
                "ipv4": true,
                "ipv6": false,
                "ipv6_address": "",
                "ipv6_dns_record": [],
                "mac_address": "d0:0d:c0:c6:68:56",
                "nat": true,
                "nat_dns_record": [],
                "nat_ip_address": "46.21.247.166",
                "nat_ip_version": "IPV4",
                "security_group_ids": null,
                "subnet_id": "e9b2p35kujbjsqnchpm1"
              }
            ],
            "placement_policy": [
              {
                "host_affinity_rules": [],
                "placement_group_id": "",
                "placement_group_partition": 0
              }
            ],
            "platform_id": "standard-v3",
            "resources": [
              {
                "core_fraction": 100,
                "cores": 2,
                "gpus": 0,
                "memory": 16
              }
            ],
            "scheduling_policy": [
              {
                "preemptible": true
              }
            ],
            "secondary_disk": [],
            "service_account_id": "ajeod1rlrk8lgql32dpb",
            "status": "running",
            "timeouts": null,
            "zone": "ru-central1-a"
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "metadata"
              },
              {
                "type": "index",
                "value": {
                  "value": "user-data",
                  "type": "string"
                }
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "time_sleep.wait_for_s3_key",
            "tls_private_key.cluster_key",
            "yandex_compute_disk.boot_disk",
            "yandex_dataproc_cluster.dataproc_cluster",
            "yandex_iam_service_account.sa",
            "yandex_iam_service_account_static_access_key.sa-static-key",
            "yandex_resourcemanager_folder_iam_member.sa_roles",
            "yandex_storage_bucket.clean_bucket",
            "yandex_vpc_gateway.nat_gateway",
            "yandex_vpc_network.network",
            "yandex_vpc_route_table.route_table",
            "yandex_vpc_security_group.security_group",
            "yandex_vpc_subnet.subnet"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_dataproc_cluster",
      "name": "dataproc_cluster",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "autoscaling_service_account_id": "",
            "bucket": "otus-bucket3-b1gukkncvsp3tvci7gp3",
            "cluster_config": [
              {
                "hadoop": [
                  {
                    "initialization_action": [],
                    "oslogin": false,
                    "properties": {
                      "yarn:yarn.resourcemanager.am.max-attempts": "5"
                    },
                    "services": [
                      "HDFS",
                      "SPARK",
                      "YARN"
                    ],
                    "ssh_public_keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGswHGXluK+PlRQzQSkWjEIVFLgf2oVF6SHJPwHDois4\n",
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOa4ue9IgOf45LGBiIxPP7aQT5+Jxhy7jsnr+C7a0jJJ rk@DESKTOP-4HH2JVC\r\n"
                    ]
                  }
                ],
                "subcluster_spec": [
                  {
                    "assign_public_ip": false,
                    "autoscaling_config": [],
                    "hosts_count": 1,
                    "id": "c9ql8p4m52jdb17tuarg",
                    "name": "master",
                    "resources": [
                      {
                        "disk_size": 40,
                        "disk_type_id": "network-ssd",
                        "resource_preset_id": "s3-c4-m16"
                      }
                    ],
                    "role": "MASTERNODE",
                    "subnet_id": "e9b2p35kujbjsqnchpm1"
                  },
                  {
                    "assign_public_ip": false,
                    "autoscaling_config": [],
                    "hosts_count": 3,
                    "id": "c9qfojbd5f78b8d8isik",
                    "name": "data",
                    "resources": [
                      {
                        "disk_size": 128,
                        "disk_type_id": "network-ssd",
                        "resource_preset_id": "s3-c8-m32"
                      }
                    ],
                    "role": "DATANODE",
                    "subnet_id": "e9b2p35kujbjsqnchpm1"
                  }
                ],
                "version_id": "2.0"
              }
            ],
            "created_at": "2025-12-28T07:10:51Z",
            "deletion_protection": false,
            "description": "Dataproc Cluster created by Terraform for OTUS project",
            "environment": "PRESTABLE",
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "host_group_ids": null,
            "id": "c9qh7vks2p8oa7os2eip",
            "labels": {
              "created_by": "terraform"
            },
            "log_group_id": "",
            "name": "otus-dataproc-cluster",
            "security_group_ids": [
              "enpmuj6tli8klpv0c9eh"
            ],
            "service_account_id": "ajeod1rlrk8lgql32dpb",
            "timeouts": null,
            "ui_proxy": false,
            "zone_id": "ru-central1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInVwZGF0ZSI6MzYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "time_sleep.wait_for_s3_key",
            "tls_private_key.cluster_key",
            "yandex_iam_service_account.sa",
            "yandex_iam_service_account_static_access_key.sa-static-key",
            "yandex_resourcemanager_folder_iam_member.sa_roles",
            "yandex_storage_bucket.clean_bucket",
            "yandex_vpc_gateway.nat_gateway",
            "yandex_vpc_network.network",
            "yandex_vpc_route_table.route_table",
            "yandex_vpc_security_group.security_group",
            "yandex_vpc_subnet.subnet"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_iam_service_account",
      "name": "sa",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "created_at": "2025-12-28T07:10:13Z",
            "description": "Service account for Dataproc cluster and related services",
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "id": "ajeod1rlrk8lgql32dpb",
            "labels": null,
            "name": "otus-sa",
            "service_account_id": "ajeod1rlrk8lgql32dpb",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_iam_service_account_static_access_key",
      "name": "sa-static-key",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "access_key": "YCAJE_8F8bdUdVmW_iAtM1pmx",
            "created_at": "2025-12-28T07:10:16Z",
            "description": "Static access key for object storage",
            "encrypted_secret_key": null,
            "id": "aje5dlf4e6qvsr280o1t",
            "key_fingerprint": null,
            "output_to_lockbox": [],
            "output_to_lockbox_version_id": null,
            "pgp_key": null,
            "secret_key": "YCOSU74kQN2JM8-RAVJSgi6FsC1UWonOR9aKtnak",
            "service_account_id": "ajeod1rlrk8lgql32dpb"
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_key"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_resourcemanager_folder_iam_member",
      "name": "sa_roles",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "index_key": "compute.admin",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "compute.admin",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        },
        {
          "index_key": "dataproc.agent",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "dataproc.agent",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        },
        {
          "index_key": "dataproc.editor",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "dataproc.editor",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        },
        {
          "index_key": "iam.serviceAccounts.user",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "iam.serviceAccounts.user",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        },
        {
          "index_key": "mdb.dataproc.agent",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "mdb.dataproc.agent",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        },
        {
          "index_key": "storage.admin",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "storage.admin",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        },
        {
          "index_key": "vpc.user",
          "schema_version": 0,
          "attributes": {
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "member": "serviceAccount:ajeod1rlrk8lgql32dpb",
            "role": "vpc.user",
            "sleep_after": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "dependencies": [
            "yandex_iam_service_account.sa"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_storage_bucket",
      "name": "clean_bucket",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "access_key": "YCAJE_8F8bdUdVmW_iAtM1pmx",
            "acl": null,
            "anonymous_access_flags": [
              {
                "config_read": false,
                "list": false,
                "read": false
              }
            ],
            "bucket": "otus-bucket3-b1gukkncvsp3tvci7gp3",
            "bucket_domain_name": "otus-bucket3-b1gukkncvsp3tvci7gp3.storage.yandexcloud.net",
            "bucket_prefix": null,
            "cors_rule": [],
            "default_storage_class": "STANDARD",
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "force_destroy": true,
            "grant": [],
            "https": [],
            "id": "otus-bucket3-b1gukkncvsp3tvci7gp3",
            "lifecycle_rule": [],
            "logging": [],
            "max_size": 0,
            "object_lock_configuration": [],
            "policy": "",
            "secret_key": "YCOSU74kQN2JM8-RAVJSgi6FsC1UWonOR9aKtnak",
            "server_side_encryption_configuration": [],
            "tags": null,
            "versioning": [
              {
                "enabled": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_key"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "time_sleep.wait_for_s3_key",
            "yandex_iam_service_account.sa",
            "yandex_iam_service_account_static_access_key.sa-static-key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_storage_object",
      "name": "spark_job_script",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "access_key": null,
            "acl": "private",
            "bucket": "otus-bucket3-b1gukkncvsp3tvci7gp3",
            "content": null,
            "content_base64": null,
            "content_type": "text/x-python",
            "id": "scpts/clean_data.py",
            "key": "scpts/clean_data.py",
            "object_lock_legal_hold_status": null,
            "object_lock_mode": null,
            "object_lock_retain_until_date": null,
            "secret_key": null,
            "source": "./scripts/clean_data.py",
            "source_hash": null,
            "tags": null
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "secret_key"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "time_sleep.wait_for_s3_key",
            "yandex_iam_service_account.sa",
            "yandex_iam_service_account_static_access_key.sa-static-key",
            "yandex_storage_bucket.clean_bucket"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_gateway",
      "name": "nat_gateway",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-12-28T07:10:13Z",
            "description": "",
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "id": "enpkq1vuajbruj8najq2",
            "labels": {},
            "name": "otus-nat-gateway",
            "shared_egress_gateway": [
              {}
            ],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMCwiZGVsZXRlIjo2MDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_network",
      "name": "network",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-12-28T07:10:13Z",
            "default_security_group_id": "enpedk7rts2bdgvdp8p8",
            "description": "",
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "id": "enpijfe0s1bq4t2l9u63",
            "labels": {},
            "name": "otus-network",
            "subnet_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMCwiZGVsZXRlIjo2MDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_route_table",
      "name": "route_table",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-12-28T07:10:15Z",
            "description": "",
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "id": "enprk9kdvp2lkphqdnb0",
            "labels": {},
            "name": "otus-route-table",
            "network_id": "enpijfe0s1bq4t2l9u63",
            "static_route": [
              {
                "destination_prefix": "0.0.0.0/0",
                "gateway_id": "enpkq1vuajbruj8najq2",
                "next_hop_address": ""
              }
            ],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAsImRlbGV0ZSI6MTgwMDAwMDAwMDAwLCJ1cGRhdGUiOjE4MDAwMDAwMDAwMH19",
          "dependencies": [
            "yandex_vpc_gateway.nat_gateway",
            "yandex_vpc_network.network"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_security_group",
      "name": "security_group",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-12-28T07:10:17Z",
            "description": "Security group for Dataproc cluster",
            "egress": [
              {
                "description": "Full outbound access",
                "from_port": -1,
                "id": "enpacbmvf59b8kbrl71s",
                "labels": {},
                "port": -1,
                "predefined_target": "",
                "protocol": "ANY",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "v6_cidr_blocks": []
              }
            ],
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "id": "enpmuj6tli8klpv0c9eh",
            "ingress": [
              {
                "description": "Internal Dataproc traffic",
                "from_port": -1,
                "id": "enp2l4go8ecsrdpfnvre",
                "labels": {},
                "port": -1,
                "predefined_target": "self_security_group",
                "protocol": "ANY",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [],
                "v6_cidr_blocks": []
              },
              {
                "description": "Jupyter access only from Proxy",
                "from_port": -1,
                "id": "enpibjf4q59b477tlgt5",
                "labels": {},
                "port": 8888,
                "predefined_target": "",
                "protocol": "TCP",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [
                  "10.0.0.100/32"
                ],
                "v6_cidr_blocks": []
              },
              {
                "description": "SSH allowed only from Proxy",
                "from_port": -1,
                "id": "enp2ui3n3br00n7l8npr",
                "labels": {},
                "port": 22,
                "predefined_target": "",
                "protocol": "TCP",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [
                  "10.0.0.100/32"
                ],
                "v6_cidr_blocks": []
              },
              {
                "description": "Web UI access only from Proxy",
                "from_port": -1,
                "id": "enp3knp8lsffa56dq4e1",
                "labels": {},
                "port": 18080,
                "predefined_target": "",
                "protocol": "TCP",
                "security_group_id": "",
                "to_port": -1,
                "v4_cidr_blocks": [
                  "10.0.0.100/32"
                ],
                "v6_cidr_blocks": []
              }
            ],
            "labels": {},
            "name": "otus-security-group",
            "network_id": "enpijfe0s1bq4t2l9u63",
            "status": "ACTIVE",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAsImRlbGV0ZSI6MTgwMDAwMDAwMDAwLCJ1cGRhdGUiOjE4MDAwMDAwMDAwMH19",
          "dependencies": [
            "yandex_vpc_network.network"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "yandex_vpc_subnet",
      "name": "subnet",
      "provider": "provider[\"registry.terraform.io/yandex-cloud/yandex\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "created_at": "2025-12-28T07:10:17Z",
            "description": "",
            "dhcp_options": [],
            "folder_id": "b1gukkncvsp3tvci7gp3",
            "id": "e9b2p35kujbjsqnchpm1",
            "labels": {},
            "name": "otus-subnet",
            "network_id": "enpijfe0s1bq4t2l9u63",
            "route_table_id": "enprk9kdvp2lkphqdnb0",
            "timeouts": null,
            "v4_cidr_blocks": [
              "10.0.0.0/24"
            ],
            "v6_cidr_blocks": [],
            "zone": "ru-central1-a"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAsImRlbGV0ZSI6MTgwMDAwMDAwMDAwLCJ1cGRhdGUiOjE4MDAwMDAwMDAwMH19",
          "dependencies": [
            "yandex_vpc_gateway.nat_gateway",
            "yandex_vpc_network.network",
            "yandex_vpc_route_table.route_table"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
